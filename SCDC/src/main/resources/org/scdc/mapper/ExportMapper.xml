<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "//mybatis.org/DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="org.scdc.mapper.ExportMapper">

<!--  1-1. 품목목록보기///////////////////////////////-->
	<select id = "getList" resultType="org.scdc.domain.PartVO">
		<!-- > 부호를 xml로 인식하지 말라 -->
		<![CDATA[
			select * from tbl_part
		]]>
	</select>
	
<!--  1-1-1. 품목목록보기 with page ///////////////////////////////-->	
	<select id="getListWithPaging" resultType="org.scdc.domain.PartVO" >
	
		<![CDATA[
			select partCode, partName, nickName, library, drw_No, drw_Img, common, remark
			from (select rownum rn, partCode, partName, nickName, library, drw_No, drw_Img, common, remark
			    from (select * from tbl_Part)
			    where rownum <=(#{pageNum}*#{amount})	) 
			where rn >((#{pageNum}-1)*#{amount})
		]]>
	
	</select>
<!-- 총글 개수 -->	
	<select id="count" resultType="int">
		select count(*) from tbl_part
	</select>
	
	
<!--  1-2. 재고목록보기  ///////////////////////////////-->	
	<select id="getStockList" resultType="org.scdc.domain.StockVO" >
	
	<![CDATA[ 
select 
         stock_no, stock_date, stockQuantity, a.partCode 
      from tbl_part a, tbl_stock b 
      where a.partcode=b.partcode
		]]>
		
	</select>
<!--  1-2-1. 재고목록보기  with page ///////////////////////////////-->	
	<select id="getStockListWithPaging" resultType="org.scdc.domain.StockVO" >
	
	<![CDATA[
		select stock_no, stock_date, stockQuantity, partCode
			from (select rownum rn, stock_no, stock_date, stockQuantity, partCode
			    from (select stock_no, stock_date, stockQuantity, a.partCode 
      						from tbl_part a, tbl_stock b 
     				 		where a.partcode=b.partcode)
			    where rownum <=(#{pageNum}*#{amount})	) 
			where rn >((#{pageNum}-1)*#{amount})
		]]>
		
	</select>

<!--  1-3. 출고목록보기  ///////////////////////////////-->	
	<select id="getExportList" resultType="org.scdc.domain.ExportVO" >
	
	<![CDATA[
	select 
	      export_no, export_date, exportQuantity, a.partCode 
	      from tbl_part a, tbl_export b 
	      where a.partcode=b.partcode
		]]>
		
	</select>
	
<!--  2. 상세보기///////////////////////////////-->

	<select id="read" >

	</select>
	
<!--  3. 출고///////////////////////////////-->
	
	<insert id="insert">
		insert into tbl_export(export_no, exportQuantity, partCode)
   			values(seq_board.nextval, #{exportQuantity},#{partCode})

	</insert>
	
<!--  3-1. 출고///////////////////////////////-->
	<insert id = "insertSelectKey">
		<selectKey>

		</selectKey>

	</insert>
	
<!--  4. 재고 업데이트///////////////////////////////-->
	
	<update id ="update">
		update tbl_stock set stockQuantity=#{stockQuantity}-#{exportQuantity}, 
    	stock_date=sysdate where partCode =#{partCode}

	</update>

	
</mapper>